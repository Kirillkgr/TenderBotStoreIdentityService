# Backend — TenantContext и публичные пути

## Контекст арендатора

- Контекст хранит `masterId`/`brandId` и используется в фильтрах и сервисах для ограничения данных.
- Установка контекста происходит через фильтры (cookie/заголовки) и должна присутствовать на защищённых вызовах.

## Фильтры и публичные пути

- `ContextEnforcementFilter` пропускает публичные пути без контекста (Swagger, auth, longpoll, public и др.).
- Для остальных путей отсутствие контекста может приводить к пустым результатам или 401/403.

## Ограничение данных на уровне сервисов

- Пример: `OrderAdminServiceImpl.findOrdersForBrands()` — добавлен фильтр по `TenantContext.getMasterId()` на `order.brand.master.id`.
- Без `masterId` метод возвращает пустую страницу — предотвращает межтенантные утечки.

## Рекомендации

- Всегда проверяйте, что выборки админских данных ограничены текущим `masterId`.
- В контроллерах корректно валидируйте доступ (RBAC) и принадлежность сущностей текущему контексту.
