# Backend — ACL заказов (tenant/master/brand)

## Цели

- Исключить межтенантные утечки заказов.
- Обеспечить доступ только персоналу бренда и клиенту заказа.

## Главные правила

- Списки заказов для персонала ограничиваются:
  - членством пользователя в бренде (UserBrandMembership),
  - текущим `masterId` в `TenantContext`.
- Клиент видит только свои заказы.

## Ключевые места

- `OrderAdminServiceImpl.findOrdersForBrands()` — добавлен фильтр `order.brand.master.id = TenantContext.getMasterId()`.
- `OrderController` — проверки ACL по ролям/членству при чтении/изменении/переписке.
- `CheckoutServiceImpl` — при оформлении заказа без членства создаётся `UserBrandMembership` (CLIENT).

## Рекомендации

- Везде, где формируются списки/поиск заказов, добавляйте фильтр по `masterId`.
- Любые операции изменения статуса/сообщений проверяйте через RBAC/членство.
