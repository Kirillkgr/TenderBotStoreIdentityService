# RBAC: Матрица доступа

Документ описывает правила доступа (ролевая матрица) для публичных и защищённых эндпоинтов сервиса идентификации и
связанных доменов.

## Роли

- OWNER — владелец бренда/мастера. Имеет полный доступ в пределах своего мастер‑контекста.
- ADMIN — администрирование бренда: управление меню, заказами, пользователями бренда.
- CLIENT — клиент бренда: оформление заказов, просмотр меню.
- ANONYMOUS — неаутентифицированный пользователь: доступ только к публичным эндпоинтам.

## Контекст

- X-Master-Id — заголовок контекста мастера. Для защищённых эндпоинтов обязателен.
- Authorization: Bearer <token> — JWT токен аутентифицированного пользователя.

## Правила (высокоуровнево)

- Публичные эндпоинты (`/menu/v1/**`) — доступны всем (ANONYMOUS), контекст не требуется.
- Защищённые эндпоинты (`/auth/v1/**`, часть `/order/v1/**`) — требуют аутентификацию и корректный контекст.
- Управление сущностями бренда (теги, группа тегов, медиа, товары) — ADMIN/OWNER в рамках бренда и мастера.
- Просмотр собственных заказов — любой аутентифицированный пользователь.
- Просмотр заказов бренда — ADMIN/OWNER бренда.

## Примеры

- Media upload: только ADMIN/OWNER и при наличии `X-Master-Id`.
- GroupTag: создание/переименование/удаление — ADMIN/OWNER; CLIENT — запрет (403).
- Orders:
    - `/order/v1/my` — аутентификация обязательна.
    - `/order/v1/brand/{id}/orders` — ADMIN/OWNER бренда.

## Примечания к реализации

- Токен‑валидация: сервисы `JwtUtils`, `TokenService`, `UserService`.
- Контекст‑фильтр: требование `X-Master-Id` на защищённых маршрутах.
- Валидация и статусы (401/403) могут отличаться в текущей ветке; см. задачи B2‑CI‑1 (вариант B) для включения строгих
  проверок.
